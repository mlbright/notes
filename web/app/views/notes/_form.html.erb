<%= form_with model: note, class: "max-w-2xl mx-auto" do |f| %>
  <div class="bg-white rounded-2xl border border-gray-200 shadow-md overflow-hidden">
    <% if note.errors.any? %>
      <div class="p-4 bg-red-50 border-b border-red-200 text-red-700 text-sm">
        <ul class="list-disc pl-4 space-y-0.5">
          <% note.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%# Title field â€” borderless, big %>
    <div class="px-5 pt-5">
      <%= f.text_field :title, placeholder: "Title", class: "w-full text-lg font-medium border-0 p-0 focus:ring-0 bg-transparent placeholder-gray-400 text-gray-900" %>
    </div>

    <%# Editor area %>
    <div class="px-5 pb-4" data-controller="editor">
      <div class="flex items-center gap-1 mb-3 pt-2 border-t border-gray-100 mt-3">
        <button type="button" data-action="click->editor#toggleMode" data-editor-target="modeToggle" class="text-xs px-2.5 py-1 rounded-md bg-gray-100 hover:bg-gray-200 text-gray-600 transition font-medium">
          Markdown
        </button>
        <div data-editor-target="toolbar" class="flex items-center gap-0.5 ml-1">
          <button type="button" data-action="click->editor#bold" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Bold"><strong class="text-xs">B</strong></button>
          <button type="button" data-action="click->editor#italic" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Italic"><em class="text-xs">I</em></button>
          <button type="button" data-action="click->editor#heading" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Heading"><span class="text-xs font-bold">H</span></button>
          <button type="button" data-action="click->editor#bulletList" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="List">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/></svg>
          </button>
          <button type="button" data-action="click->editor#orderedList" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Numbered list"><span class="text-xs font-mono">1.</span></button>
          <button type="button" data-action="click->editor#codeBlock" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Code">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
          </button>
          <button type="button" data-action="click->editor#blockquote" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Quote">
            <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983z"/></svg>
          </button>
          <button type="button" data-action="click->editor#link" class="w-7 h-7 flex items-center justify-center rounded hover:bg-gray-100 text-gray-500 transition" title="Link">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
          </button>
        </div>
      </div>

      <%# Rich text editor (Tiptap) %>
      <div data-editor-target="richEditor" class="min-h-[250px] prose prose-sm max-w-none focus:outline-none text-gray-700"></div>

      <%# Markdown editor (hidden by default) %>
      <%= f.text_area :body, data: { editor_target: "markdownEditor" }, class: "hidden w-full min-h-[250px] font-mono text-sm p-0 border-0 focus:ring-0 bg-transparent resize-y text-gray-700 placeholder-gray-400", placeholder: "Take a note..." %>

      <%# Hidden field to sync content %>
      <%= f.hidden_field :body, data: { editor_target: "hiddenField" }, id: "note_body_hidden" %>
    </div>

    <%# Bottom toolbar %>
    <div class="px-4 py-3 border-t border-gray-100 flex items-center justify-between bg-gray-50/50">
      <div class="text-xs text-gray-400">
        <span data-editor-target="charCount">0</span> / <%= note.max_size || 32_768 %> chars
      </div>
      <div class="flex items-center gap-2">
        <%= link_to "Cancel", note.persisted? ? note_path(note) : notes_path, class: "px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium transition" %>
        <%= f.submit note.persisted? ? "Save" : "Create", class: "px-5 py-2 bg-amber-500 text-white text-sm font-medium rounded-lg hover:bg-amber-600 transition cursor-pointer shadow-sm" %>
      </div>
    </div>
  </div>
<% end %>
  </div>
<% end %>
